---
const { exploit } = Astro.props || { /* I WILL LITERALLY FUCKING DIE IF THIS FAILS */ };
---

<div class="card">
  <div class="entry-head">
    <div>
      <h1 class="entry-title">{exploit?.name}</h1>
      <div class="meta">
        {exploit?.meta?.subtext}
      </div>
    </div>

    <div class="badges">
      {
        exploit?.status ? (
          <span class={`badge ${exploit?.status.toLowerCase()}`}>
            {exploit?.status}
          </span>
        ) : null
      }
    </div>
  </div>

  <div class="entry-body">
    {
      exploit?.warnings?.length ? (
        <div class="cw" role="note" aria-label="Content warning">
          <details class="dropdown" open>
            <summary class="dropdown-summary" aria-hidden="true">
              Warnings
            </summary>
            <ul class="dropdown-list">
              {exploit?.warnings?.map((w: any) => (
                <li>
                  <p set:html={w} />
                </li>
              ))}
            </ul>
          </details>
        </div>
      ) : null
    }

    {
      Array.isArray(exploit?.description)
        ? exploit.description.map((w: string) => (
            <p set:html={w} />
          ))
        : null
    }

    {
      exploit?.websites?.length ? (
        <p>
          To access their website please go to:
          {exploit?.websites?.map((w: any, i: number) => {
            const href =
              typeof w === "string"
                ? w.startsWith("http")
                  ? w
                  : `https://${w}`
                : w.url;
            const label = typeof w === "string" ? w : w.title || w.url;
            return (
              <>
                <a href={href} target="_blank" rel="noreferrer">
                  {label}
                </a>
                {i < exploit?.websites?.length - 1 ? " or " : ""}
              </>
            );
          })}
        </p>
      ) : null
    }

    {
      exploit?.developers?.length ? (
        <>
          <h3>Misc Information</h3>
          <p>
            Known developers (as publicly reported):{" "}
            {exploit?.developers?.join(", ")}.
          </p>
        </>
      ) : null
    }

    {
      exploit?.former_names?.length ? (
        <div class="table-wrapper">
          <details>
            <summary>
              Former Names of <strong>{exploit?.name}</strong>
            </summary>
            <div class="section">
              <table>
                <thead>
                  <tr>
                    <th>Former Names</th>
                    <th>Year</th>
                  </tr>
                </thead>
                <tbody>
                  {exploit?.former_names?.map(
                    (fn: { name: unknown; year: any }) => (
                      <tr>
                        <td>{fn.name}</td>
                        <td>{fn.year ?? "unknown"}</td>
                      </tr>
                    )
                  )}
                </tbody>
              </table>
            </div>
          </details>
        </div>
      ) : null
    }

    {
      exploit?.pricing?.length ? (
        <div class="table-wrapper">
          <details>
            <summary>
              Pricing of <strong>{exploit?.name}</strong>
            </summary>
            <div class="section">
              <table>
                <thead>
                  <tr>
                    <th>Method</th>
                    <th>Price</th>
                    <th>Length</th>
                  </tr>
                </thead>
                <tbody>
                  {exploit?.pricing?.map((p: any) => (
                    <tr>
                      <td>{p.method}</td>
                      <td>
                        {typeof p.price === "number"
                          ? `${p.currency ? p.currency + " " : "$"}${p.price}`
                          : p.price}
                      </td>
                      <td>{p.duration}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </details>
        </div>
      ) : null
    }

    {
      exploit?.screenshots?.length ? (
        <div class="table-wrapper screenshots">
          <details>
            <summary>Screenshots of {exploit?.name}</summary>
            <div class="section">
              {exploit?.screenshots?.map(
                (s: { year?: unknown; path?: string }) => (
                  <div>
                    <p class="muted">
                      {exploit?.name} ({s.year})
                    </p>
                    {s.path ? (
                      <img
                        src={s.path}
                        alt={`${exploit?.name} ${s.year}`}
                        loading="lazy"
                      />
                    ) : (
                      <div>SOON</div>
                    )}
                  </div>
                )
              )}
            </div>
          </details>
        </div>
      ) : null
    }

    <p class="muted">
      If you want the documentation please <strong>click me!</strong>
    </p>
  </div>
</div>
